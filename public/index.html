<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Theater, safe baseline</title>
  <style>
    body{margin:0;background:#000;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    header{display:flex;justify-content:space-between;align-items:center;padding:12px 18px;background:#0b0b0b;border-bottom:1px solid #111}
    h1{margin:0;font-size:18px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:36px;padding:36px;justify-items:center;align-items:center}
    .tile{display:flex;flex-direction:column;align-items:center;gap:10px}
    .tile-link{display:flex;flex-direction:column;align-items:center;justify-content:center;text-decoration:none;color:#fff}
    .logo{height:110px;display:flex;align-items:center;justify-content:center}
    .logo img{max-height:110px;max-width:200px;object-fit:contain}
    .caption{font-size:18px;font-weight:600;text-align:center}
    footer{padding:12px 18px;color:#9aa7b6;font-size:14px;text-align:center}
    .toggle{display:flex;align-items:center;gap:8px;font-size:14px}
    a.basic{color:#8ab4ff}
  </style>
</head>
<body>
  <header>
    <h1>My Theater</h1>
    <label class="toggle"><input type="checkbox" id="openDirect"> Open directly</label>
  </header>

  <main id="app">
    <div id="grid" class="grid" aria-live="polite"></div>
  </main>

  <footer id="foot">Tap any tile to open. If this page ever fails, you will still see simple links.</footer>

  <script>
    (function(){
      const OPEN_KEY = "abt_open_mode_v1"; // "direct" or "youtube"
      const sites = [
        { id:"prime",   name:"Prime Video", url:"https://www.primevideo.com", logo:"https://upload.wikimedia.org/wikipedia/commons/f/f1/Prime_Video.png" },
        { id:"netflix", name:"Netflix",     url:"https://www.netflix.com",    logo:"https://upload.wikimedia.org/wikipedia/commons/0/08/Netflix_2015_logo.svg" },
        { id:"disney",  name:"Disney+",     url:"https://www.disneyplus.com", logo:"https://upload.wikimedia.org/wikipedia/commons/3/3e/Disney%2B_logo.svg" },
        { id:"youtube", name:"YouTube",     url:"https://www.youtube.com",    logo:"https://upload.wikimedia.org/wikipedia/commons/b/b8/YouTube_Logo_2017.svg" }
      ];

      function getMode(){ try{ return localStorage.getItem(OPEN_KEY) || "youtube"; }catch{ return "youtube"; } }
      function setMode(m){ try{ localStorage.setItem(OPEN_KEY,m); }catch{} }
      function yt(u){ return "https://www.youtube.com/redirect?q="+encodeURIComponent(u); }

      function mountGrid(){
        const grid = document.getElementById("grid");
        grid.innerHTML = "";
        for(const s of sites){
          const tile = document.createElement("div"); tile.className = "tile";
          const a = document.createElement("a"); a.className = "tile-link"; a.href = s.url; a.dataset.url = s.url;
          const logo = document.createElement("div"); logo.className = "logo";
          const img = new Image(); img.src = s.logo; img.alt = s.name; logo.appendChild(img);
          const cap = document.createElement("div"); cap.className = "caption"; cap.textContent = s.name;
          a.appendChild(logo); a.appendChild(cap); tile.appendChild(a); grid.appendChild(tile);
        }
      }

      function bindClicks(){
        const grid = document.getElementById("grid");
        grid.addEventListener("click", (e) => {
          const a = e.target.closest("a.tile-link"); if(!a) return; e.preventDefault();
          const url = a.dataset.url; const mode = getMode();
          if(mode === "direct"){ window.location.assign(url); return; }
          const y = yt(url); window.location.assign(y);
          setTimeout(()=>{ if(location.hostname.includes("youtube.com")) window.location.assign(url); }, 1800);
        });
      }

      function wireToggle(){
        const cb = document.getElementById("openDirect");
        cb.checked = getMode() === "direct";
        cb.onchange = () => setMode(cb.checked ? "direct" : "youtube");
      }

      function safeStart(){
        try{
          wireToggle();
          mountGrid();
          bindClicks();
        }catch(err){
          // crash guard: show basic anchors so the page is never blank
          const grid = document.getElementById("grid");
          grid.innerHTML = sites.map(s=>`<p><a class="basic" href="${s.url}">${s.name}</a></p>`).join("");
          const foot = document.getElementById("foot");
          foot.textContent = "Basic links rendered due to a script error. Navigation still works.";
          console.error(err);
        }
      }

      document.addEventListener("DOMContentLoaded", safeStart);
      // also run immediately in case this file is injected late
      safeStart();
    })();
  </script>
</body>
</html>
